/*
 Copyright (c)2006-2022 Nicholas K. Dionysopoulos / Akeeba Ltd
 @license   GNU General Public License version 3, or later
*/
if("undefined"==typeof akeeba)var akeeba={};"undefined"==typeof akeeba.Dbfilters&&(akeeba.Dbfilters={currentRoot:null});akeeba.Dbfilters.activeRootChanged=function(){var a=document.getElementById("active_root");akeeba.Dbfilters.load({root:a.options[a.selectedIndex].value})};akeeba.Dbfilters.activeTabRootChanged=function(){var a=document.getElementById("active_root");akeeba.Dbfilters.loadTab(a.options[a.selectedIndex].value)};
akeeba.Dbfilters.load=function(a){a.verb="list";a={action:JSON.stringify(a)};akeeba.System.doAjax(a,function(c){akeeba.Dbfilters.render(c)},null,!1,15E3)};akeeba.Dbfilters.toggle=function(a,c,d){akeeba.Fsfilters.toggle(a,c,d)};
akeeba.Dbfilters.render=function(a){akeeba.Dbfilters.currentRoot=a.root;var c=document.getElementById("tables");c.innerHTML="";for(var d in a.tables)if(a.tables.hasOwnProperty(d)){dbef=a.tables[d];var k=document.createElement("div");k.className="table-container";for(var m=["tables","tabledata"],f=0;f<m.length;f++){var g=m[f],e=document.createElement("span");e.className="table-icon-container akeeba-btn--grey akeeba-btn--mini";e.setAttribute("title",akeeba.System.Text._("COM_AKEEBA_DBFILTER_TYPE_"+
g.toUpperCase()));switch(g){case "tables":e.insertAdjacentHTML("beforeend",'<span class="ak-toggle-button akion-close-circled"></span>');break;case "tabledata":e.insertAdjacentHTML("beforeend",'<span class="ak-toggle-button akion-ios-box"></span>')}switch(dbef[g]){case 2:akeeba.System.removeClass(e,"akeeba-btn--grey");akeeba.System.addClass(e,"akeeba-btn--red");break;case 1:akeeba.System.removeClass(e,"akeeba-btn--grey"),akeeba.System.addClass(e,"akeeba-btn--orange");case 0:akeeba.System.addEventListener(e,
"click",function(l,n,p){return function(){akeeba.Dbfilters.toggle({root:a.root,node:n,filter:p,verb:"toggle"},l)}}(e,d,g))}k.appendChild(e)}var h="akion-link",b="COM_AKEEBA_DBFILTER_TABLE_MISC";switch(dbef.type){case "table":h="akion-ios-grid-view";b="COM_AKEEBA_DBFILTER_TABLE_TABLE";break;case "view":h="akion-android-list";b="COM_AKEEBA_DBFILTER_TABLE_VIEW";break;case "procedure":h="akion-cube";b="COM_AKEEBA_DBFILTER_TABLE_PROCEDURE";break;case "function":h="akion-ion-code";b="COM_AKEEBA_DBFILTER_TABLE_FUNCTION";
break;case "trigger":h="akion-flash",b="COM_AKEEBA_DBFILTER_TABLE_TRIGGER"}m=document.createElement("span");f=document.createElement("span");g=document.createElement("span");e=document.createElement("span");m.className="table-name";m.textContent=d;f.className="table-rowcount";dbef.rows&&(f.textContent=dbef.rows,f.setAttribute("title",akeeba.System.Text._("COM_AKEEBA_DBFILTER_TABLE_META_ROWCOUNT")));g.className="table-icon-container table-icon-noclick table-icon-small";g.setAttribute("title",akeeba.System.Text._(b));
b=document.createElement("span");b.className=h;g.appendChild(b);e.className="table-icon-container table-icon-noclick table-icon-small";h=document.createElement("span");h.className="akion-android-more-vertical";h.style.color="#cccccc";e.appendChild(h);k.appendChild(e);k.appendChild(g);k.appendChild(m);k.appendChild(f);c.appendChild(k)}};akeeba.Dbfilters.loadTab=function(a){a={action:JSON.stringify({verb:"tab",root:a})};akeeba.System.doAjax(a,function(c){akeeba.Dbfilters.renderTab(c)},null,!1,15E3)};
akeeba.Dbfilters.addRow=function(a,c){var d=akeeba.System.Text._("COM_AKEEBA_DBFILTER_TYPE_"+a.type.toUpperCase());null==d&&(d=a.type);var k=document.createElement("tr"),m=document.createElement("td"),f=document.createElement("td");k.className="ak_filter_row";m.className="ak_filter_type";m.textContent=d;f.className="ak_filter_item";d=document.createElement("span");var g=document.createElement("span"),e=document.createElement("span");d.className="ak_filter_tab_icon_container akeeba-btn--mini akeeba-btn--red";
akeeba.System.addEventListener(d,"click",function(){if(""==a.node){var b=this.parentNode.parentNode;b.parentNode.removeChild(b)}else b=document.getElementById("active_root"),akeeba.Dbfilters.toggle({root:b.options[b.selectedIndex].value,node:a.node,filter:a.type,verb:"remove"},this,function(l,n){l.success&&(l=n.parentNode.parentNode,l.parentNode.removeChild(l))})});var h=document.createElement("span");h.className="ak-toggle-button icon-trash deletebutton";d.appendChild(h);g.className="ak_filter_tab_icon_container akeeba-btn--mini akeeba-btn--teal";
akeeba.System.addEventListener(g,"click",function(){if(null==this.parentNode.querySelector("input")){this.parentNode.querySelector("span.ak_filter_name").style.display="none";var b=document.createElement("input");b.setAttribute("type","text");b.setAttribute("size",60);b.value=this.parentNode.querySelector("span.ak_filter_name").textContent;this.parentNode.appendChild(b);akeeba.System.addEventListener(b,"blur",function(){var l=this.value,n=this;if(""==l)akeeba.System.triggerEvent(n.parentNode.querySelector("span.deletebutton"),
"click");else{var p=document.getElementById("active_root");p={root:p.options[p.selectedIndex].value,old_node:a.node,new_node:l,filter:a.type,verb:"swap"};var r=n.parentNode.querySelector("span.editcontainer");akeeba.Dbfilters.toggle(p,r,function(q,t){q=n.parentNode.querySelector("span.ak_filter_name");q.style.display="inline-block";q.textContent=l;n.parentNode.removeChild(n);a.node=l})}});b.focus()}});elEditIcon=document.createElement("span");elEditIcon.className="ak-toggle-button akion-edit editbutton";
g.appendChild(elEditIcon);e.className="ak_filter_name";e.textContent=a.node;f.appendChild(d);f.appendChild(g);f.appendChild(e);k.appendChild(m);k.appendChild(f);c.appendChild(k)};akeeba.Dbfilters.addNew=function(a){akeeba.Dbfilters.addRow({type:a,node:""},document.getElementById("ak_list_table").children[1]);a=document.getElementById("ak_list_table").children[1].children;akeeba.System.triggerEvent(a[a.length-1].querySelector("span.editbutton"),"click")};
akeeba.Dbfilters.renderTab=function(a){var c=document.getElementById("ak_list_contents");c.innerHTML="";for(var d=0;d<a.length;d++)akeeba.Dbfilters.addRow(a[d],c)};
akeeba.Dbfilters.excludeNonCMS=function(){var a=document.getElementById("tables").children;for(counter=0;counter<a.length;counter++){var c=a[counter];if("#__"!=c.querySelector("span.table-name").textContent.substr(0,3)){c=c.querySelector("span.table-icon-container");var d=c.querySelector("span.ak-toggle-button");-1==c.className.indexOf("akeeba-btn--orange")&&akeeba.System.triggerEvent(d,"click")}}};
akeeba.Dbfilters.nuke=function(){var a={action:JSON.stringify({root:akeeba.Dbfilters.currentRoot,verb:"reset"})};akeeba.System.doAjax(a,function(c){akeeba.Dbfilters.render(c)},null,!1,15E3)};
akeeba.Loader.add(["akeeba.System","akeeba.Ajax"],function(){var a=akeeba.System.getOptions("akeeba.DatabaseFilters.guiData",null);"list"===akeeba.System.getOptions("akeeba.DatabaseFilters.viewType",null)?(akeeba.System.addEventListener("active_root","change",akeeba.Dbfilters.activeRootChanged),akeeba.Dbfilters.render(a)):(akeeba.System.addEventListener("active_root","change",akeeba.Dbfilters.activeTabRootChanged),akeeba.Dbfilters.renderTab(a));akeeba.System.addEventListener("comAkeebaDatabaseFiltersExcludeNonCMS",
"click",function(){akeeba.Dbfilters.excludeNonCMS();return!1});akeeba.System.addEventListener("comAkeebaDatabaseFiltersNuke","click",function(){akeeba.Dbfilters.nuke();return!1});akeeba.System.addEventListener("comAkeebaDatabaseFiltersAddNewTables","click",function(){akeeba.Dbfilters.addNew("tables");return!1});akeeba.System.addEventListener("comAkeebaDatabaseFiltersAddNewTableData","click",function(){akeeba.Dbfilters.addNew("tabledata");return!1})}); //# sourceMappingURL=DatabaseFilters.min.map
