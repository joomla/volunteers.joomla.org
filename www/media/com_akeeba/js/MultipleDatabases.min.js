/*
 Copyright (c)2006-2022 Nicholas K. Dionysopoulos / Akeeba Ltd
 @license   GNU General Public License version 3, or later
*/
if("undefined"==typeof akeeba)var akeeba={};"undefined"==typeof akeeba.Multidb&&(akeeba.Multidb={modalDialog:null});akeeba.Multidb.render=function(c){var e=document.getElementById("ak_list_contents");e.innerHTML="";for(rootname in c)c.hasOwnProperty(rootname)&&akeeba.Multidb.addRow(rootname,c[rootname],e);akeeba.Multidb.addNewRecordButton(e)};
akeeba.Multidb.addRow=function(c,e,v){var p=document.createElement("tr");p.className="ak_filter_row";akeeba.System.data.set(p,"root",c);akeeba.System.data.set(p,"def",JSON.stringify(e));var t=document.createElement("td");t.style.width="2em";var q=document.createElement("span");q.className="ak_filter_tab_icon_container akeeba-btn--red--mini";akeeba.System.addEventListener(q,"click",function(){var f={root:akeeba.System.data.get(this.parentNode.parentNode,"root"),verb:"remove"};akeeba.Fsfilters.toggle(f,
this,function(b,r){1==b.success&&(b=r.parentNode.parentNode,b.parentNode.removeChild(b))})});var g=document.createElement("span");g.className="ak-toggle-button deletebutton";g.insertAdjacentHTML("beforeend",'<span class="akion-trash-a"></span>');q.appendChild(g);t.appendChild(q);q=document.createElement("td");q.style.width="2em";g=document.createElement("span");g.className="ak_filter_tab_icon_container akeeba-btn--teal--mini";akeeba.System.addEventListener(g,"click",function(){var f=this.parentNode.parentNode,
b=JSON.parse(akeeba.System.data.get(f,"def","{}"));akeeba.System.data.get(f,"root");var r=document.getElementById("akEditorDialog");""==b.driver&&(b.driver="mysqli");document.getElementById("ake_driver").value=b.driver;document.getElementById("ake_host").value=b.host;document.getElementById("ake_username").value=b.username;document.getElementById("ake_password").value=b.password;document.getElementById("ake_database").value=b.database;document.getElementById("ake_prefix").value=b.prefix;try{var h=
document.getElementById("ak_editor_notifier");h.parentNode.removeChild(h)}catch(a){}b=document.getElementById("akEditorBtnDefault");h=b.cloneNode(!0);b.parentNode.replaceChild(h,b);akeeba.System.addEventListener(h,"click",function(){try{var a=document.getElementById("ak_editor_notifier");a.parentNode.removeChild(a)}catch(l){}a=document.createElement("div");a.className="akeeba-block--info";a.id="ak_editor_notifier";var m=document.createElement("p");m.id="ak_editor_notifier_content";a.appendChild(m);
var d=document.createElement("img");d.setAttribute("border",0);d.setAttribute("src",akeeba.System.getOptions("akeeba.Multidb.loadingGif",""));m.appendChild(d);d=document.createElement("span");d.textContent=akeeba.System.Text._("COM_AKEEBA_MULTIDB_GUI_LBL_LOADING");m.appendChild(d);document.getElementById("ak_editor_table").insertAdjacentHTML("beforebegin",a.outerHTML);a=document.getElementById("ake_driver");a=a.options[a.selectedIndex];a=null==a?"":a.value;a={verb:"test",root:c,data:{host:document.getElementById("ake_host").value,
driver:a,port:document.getElementById("ake_port").value,user:document.getElementById("ake_username").value,password:document.getElementById("ake_password").value,database:document.getElementById("ake_database").value,prefix:document.getElementById("ake_prefix").value}};a={action:JSON.stringify(a)};akeeba.System.doAjax(a,function(l){var n=document.getElementById("ak_editor_notifier_content");1==l.status?(document.getElementById("ak_editor_notifier").className="akeeba-block--success",n.textContent=
akeeba.System.Text._("COM_AKEEBA_MULTIDB_GUI_LBL_CONNECTOK")):(document.getElementById("ak_editor_notifier").className="akeeba-block--failure",n.innerHTML=akeeba.System.Text._("COM_AKEEBA_MULTIDB_GUI_LBL_CONNECTFAIL")+"<br/><code>"+l.message+"</code>")},function(l){var n=document.getElementById("ak_editor_notifier_content");document.getElementById("ak_editor_notifier").className="akeeba-block--failure";n.textContent=akeeba.System.Text._("COM_AKEEBA_MULTIDB_GUI_LBL_CONNECTFAIL");"object"==typeof akeeba.Multidb.modalDialog&&
akeeba.Multidb.modalDialog.close&&akeeba.Multidb.modalDialog.close();akeeba.System.params.errorCallback(l)},!1,15E3)});b=document.getElementById("akEditorBtnSave");h=b.cloneNode(!0);b.parentNode.replaceChild(h,b);akeeba.System.addEventListener(h,"click",function(){try{var a=document.getElementById("ak_editor_notifier");a.parentNode.removeChild(a)}catch(n){}a=document.createElement("div");a.className="akeeba-block--info";a.id="ak_editor_notifier";var m=document.createElement("p");m.id="ak_editor_notifier_content";
a.appendChild(m);var d=document.createElement("img");d.setAttribute("border",0);d.setAttribute("src",akeeba.System.getOptions("akeeba.Multidb.loadingGif",""));m.appendChild(d);d=document.createElement("span");d.textContent=akeeba.System.Text._("COM_AKEEBA_MULTIDB_GUI_LBL_LOADING");m.appendChild(d);document.getElementById("ak_editor_table").insertAdjacentHTML("beforebegin",a.outerHTML);a=document.getElementById("ake_driver");a=a.options[a.selectedIndex];a=null==a?"":a.value;var l={verb:"set",root:c,
data:{host:document.getElementById("ake_host").value,driver:a,port:document.getElementById("ake_port").value,username:document.getElementById("ake_username").value,password:document.getElementById("ake_password").value,database:document.getElementById("ake_database").value,prefix:document.getElementById("ake_prefix").value,dumpFile:String(c).substr(0,9)+document.getElementById("ake_database").value+".sql"}};a={action:JSON.stringify(l)};akeeba.System.doAjax(a,function(n){1!=n?document.getElementById("ak_editor_notifier_content").textContent=
akeeba.System.Text._("COM_AKEEBA_MULTIDB_GUI_LBL_SAVEFAIL"):(akeeba.System.data.set(f,"def",JSON.stringify(l.data)),f.querySelectorAll("td"),f.querySelector("span.ak_dbhost").textContent=l.data.host,f.querySelector("span.ak_dbname").textContent=l.data.database,-1==f.querySelector("span.editbutton").firstChild.className.indexOf("akion-edit")&&(f.querySelector("span.deletebutton").parentNode.style.display="inline-block",f.querySelector("span.editbutton").firstChild.className="akion-edit",akeeba.Multidb.addNewRecordButton(f.parentNode)),
"object"==typeof akeeba.Multidb.modalDialog&&akeeba.Multidb.modalDialog.close&&akeeba.Multidb.modalDialog.close())},function(n){document.getElementById("ak_editor_notifier_content").textContent=akeeba.System.Text._("COM_AKEEBA_MULTIDB_GUI_LBL_SAVEFAIL");"object"==typeof akeeba.Multidb.modalDialog&&akeeba.Multidb.modalDialog.close&&akeeba.Multidb.modalDialog.close();akeeba.System.params.errorCallback(n)},!1,15E3)});b=document.getElementById("akEditorBtnCancel");h=b.cloneNode(!0);b.parentNode.replaceChild(h,
b);akeeba.System.addEventListener(h,"click",function(){"object"==typeof akeeba.Multidb.modalDialog&&akeeba.Multidb.modalDialog.close&&akeeba.Multidb.modalDialog.close()});akeeba.Multidb.modalDialog=akeeba.Modal.open({inherit:r,width:"80%"});akeeba.System.triggerEvent(r.querySelector("span"),"focus")});var k=document.createElement("span");k.className="editbutton ak-toggle-button";k.insertAdjacentHTML("beforeend",'<span class="akion-edit"></span>');g.appendChild(k);q.appendChild(g);g=document.createElement("td");
g.className="ak_filter_item";k=document.createElement("span");k.className="ak_filter_name ak_dbhost";k.textContent=e.host;g.appendChild(k);k=document.createElement("td");k.className="ak_filter_item";var u=document.createElement("span");u.className="ak_filter_name ak_dbname";u.textContent=e.database;k.appendChild(u);p.appendChild(t);p.appendChild(q);p.appendChild(g);p.appendChild(k);v.appendChild(p)};
akeeba.Multidb.addNewRecordButton=function(c){var e=Math.uuid();akeeba.Multidb.addRow(e,{host:"",port:"",username:"",password:"",database:"",prefix:""},c);c=document.getElementById("ak_list_contents").children;c=c[c.length-1].querySelectorAll("td");c[0].querySelector("span").style.display="none";c=c[1].querySelectorAll("span");e=c[c.length-1];console.log(c,e);e.className="akion-plus"};
akeeba.Loader.add(["akeeba.UserInterfaceCommon","akeeba.System","akeeba.Ajax"],function(){akeeba.Multidb.render(akeeba.System.getOptions("akeeba.Multidb.guiData",{}))}); //# sourceMappingURL=MultipleDatabases.min.map
