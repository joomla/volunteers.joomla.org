/*
 Copyright (c)2006-2022 Nicholas K. Dionysopoulos / Akeeba Ltd
 @license   GNU General Public License version 3, or later
*/
if("undefined"==typeof akeeba)var akeeba={};"undefined"==typeof akeeba.Restore&&(akeeba.Restore={lastResponseSeconds:0,timer:0,errorCallback:null,statistics:{inbytes:0,outbytes:0,files:0},factory:null});akeeba.Restore.errorCallbackDefault=function(a){document.getElementById("restoration-progress").style.display="none";document.getElementById("restoration-error").style.display="block";document.getElementById("backup-error-message").innerHTML=a};
akeeba.Restore.doAjax=function(a,c,d){json=JSON.stringify(a);a={json:json};var g=akeeba.System.getOptions("akeeba.Restore.password","");0<g.length&&(a.password=g);g=(new Date).getTime()/1E3;var k=parseInt(g,10);a._cacheBustingJunk=Math.round(1E3*(g-k));a={type:"POST",url:akeeba.System.getOptions("akeeba.Restore.ajaxURL",""),cache:!1,data:a,timeout:6E5,success:function(b){var f=b.indexOf("###");if(-1==f)b="Invalid AJAX data: "+b,null==d?null!=akeeba.Restore.errorCallback?akeeba.Restore.errorCallback(b):
akeeba.Restore.errorCallbackDefault(b):d(b);else{0!=f&&(b.substr(0,f),b=b.substr(f));b=b.substr(3);f=b.lastIndexOf("###");b=b.substr(0,f);try{var h=JSON.parse(b)}catch(e){errorMessage=e.message+"\n<br/>\n<pre>\n"+b+"\n</pre>";null==d?null!=akeeba.Restore.errorCallback?akeeba.Restore.errorCallback(errorMessage):akeeba.Restore.errorCallbackDefault(errorMessage):d(errorMessage);return}c(h)}},error:function(b,f,h){h=b.responseText?b.responseText:"";var e="<strong>AJAX Loading Error</strong><br/>HTTP Status: "+
b.status+" ("+b.statusText+")<br/>";e=e+"Internal status: "+f+"<br/>XHR ReadyState: "+b.readyState+"<br/>";e=e+"Raw server response:<br/>"+akeeba.System.sanitizeErrorMessage(h);null==d?null!=akeeba.Restore.errorCallback?akeeba.Restore.errorCallback(e):akeeba.Restore.errorCallbackDefault(e):d(e)}};akeeba.Ajax.ajax(a)};
akeeba.Restore.startTimeoutBar=function(a,c){akeeba.Restore.resetTimeoutBar();akeeba.Restore.timer=setInterval(function(){akeeba.Restore.lastResponseSeconds++;var d=akeeba.System.Text._("COM_AKEEBA_BACKUP_TEXT_LASTRESPONSE").replace("%s",akeeba.Restore.lastResponseSeconds.toFixed(0));try{document.getElementById("response-timer").querySelector("div.text").textContent=d}catch(g){}},1E3)};
akeeba.Restore.resetTimeoutBar=function(){akeeba.Restore.lastResponseSeconds=0;if(0!=akeeba.Restore.timer){clearInterval(akeeba.Restore.timer);akeeba.Restore.timer=0;var a=document.getElementById("response-timer").querySelector("div.text"),c=akeeba.System.Text._("COM_AKEEBA_BACKUP_TEXT_LASTRESPONSE").replace("%s","0");try{a.textContent=c}catch(d){}}};
akeeba.Restore.pingRestoration=function(){akeeba.Restore.statistics.inbytes=0;akeeba.Restore.statistics.outbytes=0;akeeba.Restore.statistics.files=0;akeeba.Restore.startTimeoutBar(5E3,80);akeeba.Restore.doAjax({task:"ping"},function(a){akeeba.Restore.start(a)})};akeeba.Restore.start=function(){akeeba.Restore.statistics.inbytes=0;akeeba.Restore.statistics.outbytes=0;akeeba.Restore.statistics.files=0;akeeba.Restore.startTimeoutBar(5E3,80);akeeba.Restore.doAjax({task:"startRestore"},function(a){akeeba.Restore.step(a)})};
akeeba.Restore.step=function(a){akeeba.Restore.resetTimeoutBar();if(0==a.status)akeeba.Restore.errorCallbackDefault(a.message);else if(a.done)akeeba.Restore.factory=a.factory,document.getElementById("restoration-progress").style.display="none",document.getElementById("restoration-extract-ok").style.display="block";else{akeeba.Restore.statistics.inbytes+=a.bytesIn;akeeba.Restore.statistics.outbytes+=a.bytesOut;akeeba.Restore.statistics.files+=a.files;try{document.getElementById("extbytesin").textContent=
akeeba.Restore.statistics.inbytes,document.getElementById("extbytesout").textContent=akeeba.Restore.statistics.outbytes,document.getElementById("extfiles").textContent=akeeba.Restore.statistics.files}catch(c){}post={task:"stepRestore",factory:a.factory};akeeba.Restore.startTimeoutBar(5E3,80);akeeba.Restore.doAjax(post,function(c){akeeba.Restore.step(c)})}};
akeeba.Restore.finalize=function(a){a.preventDefault();a={task:"finalizeRestore",factory:akeeba.Restore.factory};akeeba.Restore.startTimeoutBar(5E3,80);akeeba.Restore.doAjax(a,function(c){akeeba.Restore.finished(c)});return!1};akeeba.Restore.finished=function(){window.location=akeeba.System.getOptions("akeeba.Restore.mainURL",window.location)};
akeeba.Restore.runInstaller=function(a){a.preventDefault();window.open("../installation/index.php","abiinstaller");a=document.getElementById("restoration-runinstaller");var c=document.getElementById("restoration-finalize");a.className="akeeba-btn--grey--small";c.style.display="block";return!1};akeeba.Restore.restoreDefaultOptions=function(){var a=document.getElementById("jps_key");a&&(a.value="ThisIsADummyStringToWorkAroundChrome",a.value="")};
akeeba.Restore.onProcEngineChange=function(a){a=document.getElementById("procengine");"direct"===a.options[a.selectedIndex].value?(document.getElementById("ftpOptions").style.display="none",document.getElementById("testftp").style.display="none"):(document.getElementById("ftpOptions").style.display="block",document.getElementById("testftp").style.display="inline-block")};
akeeba.Loader.add(["akeeba.System","akeeba.Ajax","akeeba.Modal"],function(){akeeba.System.getOptions("akeeba.Restore.inMainRestoration",!1)?(akeeba.System.addEventListener(document.getElementById("restoration-runinstaller"),"click",akeeba.Restore.runInstaller),akeeba.System.addEventListener(document.getElementById("restoration-finalize"),"click",akeeba.Restore.finalize),akeeba.Restore.pingRestoration()):(akeeba.System.addEventListener("backup-start","click",function(a){a.preventDefault();document.adminForm.submit();
return!1}),akeeba.System.addEventListener("ftp-browse","click",function(a){a.preventDefault();akeeba.Configuration.FtpBrowser.initialise("ftp.initial_directory","ftp");return!1}),akeeba.System.addEventListener("testftp","click",function(a){a.preventDefault();akeeba.Configuration.FtpTest.testConnection("testftp","ftp");return!1}),akeeba.System.addEventListener("procengine","change",akeeba.Restore.onProcEngineChange),akeeba.Restore.onProcEngineChange(),setTimeout(akeeba.Restore.restoreDefaultOptions,
500))}); //# sourceMappingURL=Restore.min.map
