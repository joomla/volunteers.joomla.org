!(function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)})((function(a){function b(a,b){return"pairs"==b&&"string"==typeof a?a:"object"==typeof a&&null!=a[b]?a[b]:m[b]}function c(a){for(var b=0;b<a.length;b++){var c=a.charAt(b),e="'"+c+"'";o[e]||(o[e]=d(c))}}function d(a){return function(b){return j(b,a)}}function e(a){var b=a.state.closeBrackets;return!b||b.override?b:a.getModeAt(a.getCursor()).closeBrackets||b}function f(c){var d=e(c);if(!d||c.getOption("disableInput"))return a.Pass;for(var f=b(d,"pairs"),g=c.listSelections(),h=0;h<g.length;h++){if(!g[h].empty())return a.Pass;var i=k(c,g[h].head);if(!i||f.indexOf(i)%2!=0)return a.Pass}for(var h=g.length-1;h>=0;h--){var j=g[h].head;c.replaceRange("",n(j.line,j.ch-1),n(j.line,j.ch+1),"+delete")}}function g(c){var d=e(c),f=d&&b(d,"explode");if(!f||c.getOption("disableInput"))return a.Pass;for(var g=c.listSelections(),i=0;i<g.length;i++){if(!g[i].empty())return a.Pass;var j=k(c,g[i].head);if(!j||f.indexOf(j)%2!=0)return a.Pass}c.operation((function(){var a=c.lineSeparator()||"\n";c.replaceSelection(a+a,null),h(c,-1),g=c.listSelections();for(var b=0;b<g.length;b++){var d=g[b].head.line;c.indentLine(d,null,!0),c.indentLine(d+1,null,!0)}}))}function h(a,b){for(var c=[],d=a.listSelections(),e=0,f=0;f<d.length;f++){var g=d[f];g.head==a.getCursor()&&(e=f);var h=g.head.ch||b>0?{line:g.head.line,ch:g.head.ch+b}:{line:g.head.line-1};c.push({anchor:h,head:h})}a.setSelections(c,e)}function i(b){var c=a.cmpPos(b.anchor,b.head)>0;return{anchor:new n(b.anchor.line,b.anchor.ch+(c?-1:1)),head:new n(b.head.line,b.head.ch+(c?1:-1))}}function j(c,d){var f=e(c);if(!f||c.getOption("disableInput"))return a.Pass;var g=b(f,"pairs"),j=g.indexOf(d);if(-1==j)return a.Pass;for(var k,m=b(f,"closeBefore"),o=b(f,"triples"),p=g.charAt(j+1)==d,q=c.listSelections(),r=j%2==0,s=0;s<q.length;s++){var t,u=q[s],v=u.head,w=c.getRange(v,n(v.line,v.ch+1));if(r&&!u.empty())t="surround";else if(!p&&r||w!=d)if(p&&v.ch>1&&o.indexOf(d)>=0&&c.getRange(n(v.line,v.ch-2),v)==d+d){if(v.ch>2&&/\bstring/.test(c.getTokenTypeAt(n(v.line,v.ch-2))))return a.Pass;t="addFour"}else if(p){var x=0==v.ch?" ":c.getRange(n(v.line,v.ch-1),v);if(a.isWordChar(w)||x==d||a.isWordChar(x))return a.Pass;t="both"}else{if(!r||!(0===w.length||/\s/.test(w)||m.indexOf(w)>-1))return a.Pass;t="both"}else t=p&&l(c,v)?"both":o.indexOf(d)>=0&&c.getRange(v,n(v.line,v.ch+3))==d+d+d?"skipThree":"skip";if(k){if(k!=t)return a.Pass}else k=t}var y=j%2?g.charAt(j-1):d,z=j%2?d:g.charAt(j+1);c.operation((function(){if("skip"==k)h(c,1);else if("skipThree"==k)h(c,3);else if("surround"==k){for(var a=c.getSelections(),b=0;b<a.length;b++)a[b]=y+a[b]+z;c.replaceSelections(a,"around"),a=c.listSelections().slice();for(var b=0;b<a.length;b++)a[b]=i(a[b]);c.setSelections(a)}else"both"==k?(c.replaceSelection(y+z,null),c.triggerElectric(y+z),h(c,-1)):"addFour"==k&&(c.replaceSelection(y+y+y+y,"before"),h(c,1))}))}function k(a,b){var c=a.getRange(n(b.line,b.ch-1),n(b.line,b.ch+1));return 2==c.length?c:null}function l(a,b){var c=a.getTokenAt(n(b.line,b.ch+1));return/\bstring/.test(c.type)&&c.start==b.ch&&(0==b.ch||!/\bstring/.test(a.getTokenTypeAt(b)))}var m={pairs:"()[]{}''\"\"",closeBefore:")]}'\":;>",triples:"",explode:"[]{}"},n=a.Pos;a.defineOption("autoCloseBrackets",!1,(function(d,e,f){f&&f!=a.Init&&(d.removeKeyMap(o),d.state.closeBrackets=null),e&&(c(b(e,"pairs")),d.state.closeBrackets=e,d.addKeyMap(o))}));var o={Backspace:f,Enter:g};c(m.pairs+"`")}));