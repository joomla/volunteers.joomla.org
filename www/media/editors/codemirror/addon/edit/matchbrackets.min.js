!(function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)})((function(a){function b(a){return a&&a.bracketRegex||/[(){}[\]]/}function c(a,c,e){var f=a.getLineHandle(c.line),g=c.ch-1,h=e&&e.afterCursor;null==h&&(h=/(^| )cm-fat-cursor($| )/.test(a.getWrapperElement().className));var k=b(e),l=!h&&g>=0&&k.test(f.text.charAt(g))&&j[f.text.charAt(g)]||k.test(f.text.charAt(g+1))&&j[f.text.charAt(++g)];if(!l)return null;var m=">"==l.charAt(1)?1:-1;if(e&&e.strict&&m>0!=(g==c.ch))return null;var n=a.getTokenTypeAt(i(c.line,g+1)),o=d(a,i(c.line,g+(m>0?1:0)),m,n,e);return null==o?null:{from:i(c.line,g),to:o&&o.pos,match:o&&o.ch==l.charAt(0),forward:m>0}}function d(a,c,d,e,f){for(var g=f&&f.maxScanLineLength||1e4,h=f&&f.maxScanLines||1e3,k=[],l=b(f),m=d>0?Math.min(c.line+h,a.lastLine()+1):Math.max(a.firstLine()-1,c.line-h),n=c.line;n!=m;n+=d){var o=a.getLine(n);if(o){var p=d>0?0:o.length-1,q=d>0?o.length:-1;if(!(o.length>g))for(n==c.line&&(p=c.ch-(d<0?1:0));p!=q;p+=d){var r=o.charAt(p);if(l.test(r)&&(void 0===e||(a.getTokenTypeAt(i(n,p+1))||"")==(e||""))){var s=j[r];if(s&&">"==s.charAt(1)==d>0)k.push(r);else{if(!k.length)return{pos:i(n,p),ch:r};k.pop()}}}}}return n-d!=(d>0?a.lastLine():a.firstLine())&&null}function e(a,b,d){for(var e=a.state.matchBrackets.maxHighlightLineLength||1e3,f=d&&d.highlightNonMatching,g=[],j=a.listSelections(),k=0;k<j.length;k++){var l=j[k].empty()&&c(a,j[k].head,d);if(l&&(l.match||!1!==f)&&a.getLine(l.from.line).length<=e){var m=l.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";g.push(a.markText(l.from,i(l.from.line,l.from.ch+1),{className:m})),l.to&&a.getLine(l.to.line).length<=e&&g.push(a.markText(l.to,i(l.to.line,l.to.ch+1),{className:m}))}}if(g.length){h&&a.state.focused&&a.focus();var n=function(){a.operation((function(){for(var a=0;a<g.length;a++)g[a].clear()}))};if(!b)return n;setTimeout(n,800)}}function f(a){a.operation((function(){a.state.matchBrackets.currentlyHighlighted&&(a.state.matchBrackets.currentlyHighlighted(),a.state.matchBrackets.currentlyHighlighted=null),a.state.matchBrackets.currentlyHighlighted=e(a,!1,a.state.matchBrackets)}))}function g(a){a.state.matchBrackets&&a.state.matchBrackets.currentlyHighlighted&&(a.state.matchBrackets.currentlyHighlighted(),a.state.matchBrackets.currentlyHighlighted=null)}var h=/MSIE \d/.test(navigator.userAgent)&&(null==document.documentMode||document.documentMode<8),i=a.Pos,j={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<","<":">>",">":"<<"};a.defineOption("matchBrackets",!1,(function(b,c,d){d&&d!=a.Init&&(b.off("cursorActivity",f),b.off("focus",f),b.off("blur",g),g(b)),c&&(b.state.matchBrackets="object"==typeof c?c:{},b.on("cursorActivity",f),b.on("focus",f),b.on("blur",g))})),a.defineExtension("matchBrackets",(function(){e(this,!0)})),a.defineExtension("findMatchingBracket",(function(a,b,d){return(d||"boolean"==typeof b)&&(d?(d.strict=b,b=d):b=b?{strict:!0}:null),c(this,a,b)})),a.defineExtension("scanForBracket",(function(a,b,c,e){return d(this,a,b,c,e)}))}));