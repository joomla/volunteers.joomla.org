!(function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)})((function(a){"use strict";function b(a){for(var b={},c=0,d=a.length;c<d;++c)b[a[c]]=!0;return b}var c=["alias","and","BEGIN","begin","break","case","class","def","defined?","do","else","elsif","END","end","ensure","false","for","if","in","module","next","not","or","redo","rescue","retry","return","self","super","then","true","undef","unless","until","when","while","yield","nil","raise","throw","catch","fail","loop","callcc","caller","lambda","proc","public","protected","private","require","load","require_relative","extend","autoload","__END__","__FILE__","__LINE__","__dir__"],d=b(c),e=b(["def","class","case","for","while","until","module","then","catch","loop","proc","begin"]),f=b(["end","until"]),g={"[":"]","{":"}","(":")"},h={"]":"[","}":"{",")":"("};a.defineMode("ruby",(function(b){function c(a,b,c){return c.tokenize.push(a),a(b,c)}function i(a,b){if(a.sol()&&a.match("=begin")&&a.eol())return b.tokenize.push(o),"comment";if(a.eatSpace())return null;var d,e=a.next();if("`"==e||"'"==e||'"'==e)return c(m(e,"string",'"'==e||"`"==e),a,b);if("/"==e)return j(a)?c(m(e,"string-2",!0),a,b):"operator";if("%"==e){var f="string",h=!0;a.eat("s")?f="atom":a.eat(/[WQ]/)?f="string":a.eat(/[r]/)?f="string-2":a.eat(/[wxq]/)&&(f="string",h=!1);var i=a.eat(/[^\w\s=]/);return i?(g.propertyIsEnumerable(i)&&(i=g[i]),c(m(i,f,h,!0),a,b)):"operator"}if("#"==e)return a.skipToEnd(),"comment";if("<"==e&&(d=a.match(/^<([-~])[\`\"\']?([a-zA-Z_?]\w*)[\`\"\']?(?:;|$)/)))return c(n(d[2],d[1]),a,b);if("0"==e)return a.eat("x")?a.eatWhile(/[\da-fA-F]/):a.eat("b")?a.eatWhile(/[01]/):a.eatWhile(/[0-7]/),"number";if(/\d/.test(e))return a.match(/^[\d_]*(?:\.[\d_]+)?(?:[eE][+\-]?[\d_]+)?/),"number";if("?"==e){for(;a.match(/^\\[CM]-/););return a.eat("\\")?a.eatWhile(/\w/):a.next(),"string"}if(":"==e)return a.eat("'")?c(m("'","atom",!1),a,b):a.eat('"')?c(m('"',"atom",!0),a,b):a.eat(/[\<\>]/)?(a.eat(/[\<\>]/),"atom"):a.eat(/[\+\-\*\/\&\|\:\!]/)?"atom":a.eat(/[a-zA-Z$@_\xa1-\uffff]/)?(a.eatWhile(/[\w$\xa1-\uffff]/),a.eat(/[\?\!\=]/),"atom"):"operator";if("@"==e&&a.match(/^@?[a-zA-Z_\xa1-\uffff]/))return a.eat("@"),a.eatWhile(/[\w\xa1-\uffff]/),"variable-2";if("$"==e)return a.eat(/[a-zA-Z_]/)?a.eatWhile(/[\w]/):a.eat(/\d/)?a.eat(/\d/):a.next(),"variable-3";if(/[a-zA-Z_\xa1-\uffff]/.test(e))return a.eatWhile(/[\w\xa1-\uffff]/),a.eat(/[\?\!]/),a.eat(":")?"atom":"ident";if("|"!=e||!b.varList&&"{"!=b.lastTok&&"do"!=b.lastTok){if(/[\(\)\[\]{}\\;]/.test(e))return p=e,null;if("-"==e&&a.eat(">"))return"arrow";if(/[=+\-\/*:\.^%<>~|]/.test(e)){var k=a.eatWhile(/[=+\-\/*:\.^%<>~|]/);return"."!=e||k||(p="."),"operator"}return null}return p="|",null}function j(a){for(var b,c=a.pos,d=0,e=!1,f=!1;null!=(b=a.next());)if(f)f=!1;else{if("[{(".indexOf(b)>-1)d++;else if("]})".indexOf(b)>-1){if(--d<0)break}else if("/"==b&&0==d){e=!0;break}f="\\"==b}return a.backUp(a.pos-c),e}function k(a){return a||(a=1),function(b,c){if("}"==b.peek()){if(1==a)return c.tokenize.pop(),c.tokenize[c.tokenize.length-1](b,c);c.tokenize[c.tokenize.length-1]=k(a-1)}else"{"==b.peek()&&(c.tokenize[c.tokenize.length-1]=k(a+1));return i(b,c)}}function l(){var a=!1;return function(b,c){return a?(c.tokenize.pop(),c.tokenize[c.tokenize.length-1](b,c)):(a=!0,i(b,c))}}function m(a,b,c,d){return function(e,f){var g,h=!1;for("read-quoted-paused"===f.context.type&&(f.context=f.context.prev,e.eat("}"));null!=(g=e.next());){if(g==a&&(d||!h)){f.tokenize.pop();break}if(c&&"#"==g&&!h){if(e.eat("{")){"}"==a&&(f.context={prev:f.context,type:"read-quoted-paused"}),f.tokenize.push(k());break}if(/[@\$]/.test(e.peek())){f.tokenize.push(l());break}}h=!h&&"\\"==g}return b}}function n(a,b){return function(c,d){return b&&c.eatSpace(),c.match(a)?d.tokenize.pop():c.skipToEnd(),"string"}}function o(a,b){return a.sol()&&a.match("=end")&&a.eol()&&b.tokenize.pop(),a.skipToEnd(),"comment"}var p;return{startState:function(){return{tokenize:[i],indented:0,context:{type:"top",indented:-b.indentUnit},continuedLine:!1,lastTok:null,varList:!1}},token:function(a,b){p=null,a.sol()&&(b.indented=a.indentation());var c,g=b.tokenize[b.tokenize.length-1](a,b),h=p;if("ident"==g){var i=a.current();g="."==b.lastTok?"property":d.propertyIsEnumerable(a.current())?"keyword":/^[A-Z]/.test(i)?"tag":"def"==b.lastTok||"class"==b.lastTok||b.varList?"def":"variable","keyword"==g&&(h=i,e.propertyIsEnumerable(i)?c="indent":f.propertyIsEnumerable(i)?c="dedent":"if"!=i&&"unless"!=i||a.column()!=a.indentation()?"do"==i&&b.context.indented<b.indented&&(c="indent"):c="indent")}return(p||g&&"comment"!=g)&&(b.lastTok=h),"|"==p&&(b.varList=!b.varList),"indent"==c||/[\(\[\{]/.test(p)?b.context={prev:b.context,type:p||g,indented:b.indented}:("dedent"==c||/[\)\]\}]/.test(p))&&b.context.prev&&(b.context=b.context.prev),a.eol()&&(b.continuedLine="\\"==p||"operator"==g),g},indent:function(c,d){if(c.tokenize[c.tokenize.length-1]!=i)return a.Pass;var e=d&&d.charAt(0),f=c.context,g=f.type==h[e]||"keyword"==f.type&&/^(?:end|until|else|elsif|when|rescue)\b/.test(d);return f.indented+(g?0:b.indentUnit)+(c.continuedLine?b.indentUnit:0)},electricInput:/^\s*(?:end|rescue|elsif|else|\})$/,lineComment:"#",fold:"indent"}})),a.defineMIME("text/x-ruby","ruby"),a.registerHelper("hintWords","ruby",c)}));